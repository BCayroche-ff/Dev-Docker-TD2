# Configuration Backstage pour le TP TechMarket
# Utilise l'image de démo officielle de Backstage

backstage:
  image:
    registry: ghcr.io
    repository: backstage/backstage
    tag: latest
    pullPolicy: IfNotPresent

  # Configuration app-config.yaml intégrée
  appConfig:
    app:
      title: TechMarket IDP
      baseUrl: http://localhost:30000

    organization:
      name: TechMarket

    auth:
      environment: development
      providers:
        guest:
          dangerouslyAllowOutsideDevelopment: true
          signInResolver:
            enabled: true

    # Permissions - autoriser tout pour le TP
    permission:
      enabled: false

    backend:
      baseUrl: http://localhost:30000
      listen:
        port: 7007
      csp:
        connect-src: ["'self'", 'http:', 'https:']
      database:
        client: better-sqlite3
        connection: ':memory:'
      reading:
        allow:
          - host: raw.githubusercontent.com
          - host: github.com

    # Intégration GitHub pour le scaffolder
    integrations:
      github:
        - host: github.com

    catalog:
      rules:
        - allow: [Component, System, API, Resource, Location, Template, Group, User, Domain]

      # Catalogue TechMarket - Services réels depuis GitHub
      locations:
        # Frontend React
        - type: url
          target: https://raw.githubusercontent.com/BCayroche-ff/Dev-Docker-TD2/TD-J5/TD-Jour5/microservices/frontend/catalog-info.yaml

        # Backend API
        - type: url
          target: https://raw.githubusercontent.com/BCayroche-ff/Dev-Docker-TD2/TD-J5/TD-Jour5/microservices/backend/catalog-info.yaml

        # Payment Service
        - type: url
          target: https://raw.githubusercontent.com/BCayroche-ff/Dev-Docker-TD2/TD-J5/TD-Jour5/microservices/payment-service/catalog-info.yaml

        # Template Golden Path - Nouveau service Node.js
        - type: url
          target: https://raw.githubusercontent.com/BCayroche-ff/Dev-Docker-TD2/TD-J5/TD-Jour5/backstage/template-nodejs-service.yaml

  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m

  # Commande de démarrage
  command: ["node", "packages/backend", "--config", "app-config.yaml"]

service:
  type: NodePort
  ports:
    backend: 7007
  nodePorts:
    backend: "30000"

postgresql:
  enabled: false

ingress:
  enabled: false
